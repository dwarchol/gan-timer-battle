import{b as $,c as R}from"./chunk-SDAS6MWB.js";import{a as zt,b as Rt}from"./chunk-GYJWRRWW.js";var mt=class{constructor(e,t){this.facenames=e,t&&(this.gripnames=t);for(let s=0;this.prefixFree&&s<e.length;s++)for(let i=0;this.prefixFree&&i<e.length;i++)s!==i&&e[s].startsWith(e[i])&&(this.prefixFree=!1)}prefixFree=!0;gripnames=[];setGripNames(e){this.gripnames=e}splitByFaceNames(e){let t=[],s=0;for(;s<e.length;){s>0&&s<e.length&&e[s]==="_"&&s++;let i=-1;for(let n=0;n<this.facenames.length;n++)e.substr(s).startsWith(this.facenames[n])&&(i<0||this.facenames[n].length>this.facenames[i].length)&&(i=n);if(i>=0)t.push(i),s+=this.facenames[i].length;else throw new Error(`Could not split ${e} into face names.`)}return t}joinByFaceIndices(e){let t="",s=[];for(let i=0;i<e.length;i++)s.push(t),s.push(this.facenames[e[i]]),this.prefixFree||(t="_");return s.join("")}spinmatch(e,t){if(e===t)return!0;try{let s=this.splitByFaceNames(e),i=this.splitByFaceNames(t);if(s.length!==i.length&&s.length<3)return!1;for(let n=0;n<s.length;n++){for(let r=0;r<n;r++)if(s[n]===s[r])return!1;let o=!1;for(let r=0;r<i.length;r++)if(s[n]===i[r]){o=!0;break}if(!o)return!1}return!0}catch{return!1}}spinmatchv(e,t){return e.endsWith("v")&&t.endsWith("v")?this.spinmatch(e.slice(0,e.length-1),t.slice(0,t.length-1)):this.spinmatch(e,t)}unswizzle(e){(e.endsWith("v")||e.endsWith("w"))&&e[0]<="Z"&&(e=e.slice(0,e.length-1));let t=e.toUpperCase();for(let s=0;s<this.gripnames.length;s++){let i=this.gripnames[s];if(this.spinmatch(t,i))return i}return e}},Tt=class{notationToInternal(e){return e}notationToExternal(e){return e}},qt=class{constructor(e,t){this.child=e,this.sw=t}notationToInternal(e){return e.family==="T"&&e.innerLayer===void 0&&e.outerLayer===void 0?new R(new $("FLRv",e.innerLayer,e.outerLayer),e.amount):this.child.notationToInternal(e)}notationToExternal(e){let t=e.family;return t.length>0&&t[t.length-1]==="v"&&(t=t.substring(0,t.length-1)),this.sw.spinmatch(t,"FLUR")?new R(new $("T",e.innerLayer,e.outerLayer),e.amount):this.child.notationToExternal(e)}},Dt=class{constructor(e,t){this.internalNames=e,this.externalNames=t}convertString(e,t,s){let i="";(e.endsWith("v")||e.endsWith("v"))&&e<="_"&&(i=e.slice(e.length-1),e=e.slice(0,e.length-1));let n=e.toUpperCase(),o=!1;return e!==n&&(o=!0,e=n),e=s.joinByFaceIndices(t.splitByFaceNames(e)),o&&(e=e.toLowerCase()),e+i}convert(e,t,s){let i=e.family,n=this.convertString(i,t,s);return i===n?e:new R(new $(n,e.innerLayer,e.outerLayer),e.amount)}notationToInternal(e){return this.convert(e,this.externalNames,this.internalNames)}notationToExternal(e){return this.convert(e,this.internalNames,this.externalNames)}},_t=class{constructor(e){this.child=e}notationToInternal(e){if(e.innerLayer===void 0&&e.outerLayer===void 0){if(Math.abs(e.amount)===1){if(e.family==="R++")return new R(new $("L",3,2),-2*e.amount);if(e.family==="R--")return new R(new $("L",3,2),2*e.amount);if(e.family==="D++")return new R(new $("U",3,2),-2*e.amount);if(e.family==="D--")return new R(new $("U",3,2),2*e.amount);if(e.family==="R_PLUSPLUS_")return new R(new $("L",3,2),-2*e.amount);if(e.family==="D_PLUSPLUS_")return new R(new $("U",3,2),-2*e.amount)}if(e.family==="y")return new R("Uv",e.amount);if(e.family==="x"&&Math.abs(e.amount)===2)return new R("ERv",e.amount/2)}return this.child.notationToInternal(e)}notationToExternal(e){return e.family==="ERv"&&Math.abs(e.amount)===1?new R(new $("x",e.innerLayer,e.outerLayer),e.amount*2):e.family==="ILv"&&Math.abs(e.amount)===1?new R(new $("x",e.innerLayer,e.outerLayer),-e.amount*2):e.family==="Uv"?new R(new $("y",e.innerLayer,e.outerLayer),e.amount):e.family==="Dv"?new R("y",-e.amount):this.child.notationToExternal(e)}},te=class{constructor(e){this.slices=e}notationToInternal(e){let t=e.family;return e.innerLayer||e.outerLayer||(t==="x"?e=new R("Rv",e.amount):t==="y"?e=new R("Uv",e.amount):t==="z"&&(e=new R("Fv",e.amount)),(this.slices&1)===1&&(t==="E"?e=new R(new $("D",(this.slices+1)/2),e.amount):t==="M"?e=new R(new $("L",(this.slices+1)/2),e.amount):t==="S"&&(e=new R(new $("F",(this.slices+1)/2),e.amount))),this.slices>2&&(t==="e"?e=new R(new $("D",this.slices-1,2),e.amount):t==="m"?e=new R(new $("L",this.slices-1,2),e.amount):t==="s"&&(e=new R(new $("F",this.slices-1,2),e.amount)))),e}notationToExternal(e){let t=e.family;if(!(e.innerLayer||e.outerLayer)){if(t==="Rv")return new R("x",e.amount);if(t==="Uv")return new R("y",e.amount);if(t==="Fv")return new R("z",e.amount);if(t==="Lv")return new R("x",-e.amount);if(t==="Dv")return new R("y",-e.amount);if(t==="Bv")return new R("z",-e.amount)}return e}},ee={U:"frl",L:"fld",R:"fdr",B:"dlr",u:"FRL",l:"FLD",r:"FDR",b:"DLR",Uv:"FRLv",Lv:"FLDv",Rv:"FDRv",Bv:"DLRv",D:"D",F:"F",BL:"L",BR:"R"},se={U:"FRL",L:"FLD",R:"FDR",B:"DLR",u:"frl",l:"fld",r:"fdr",b:"dlr",Uv:"FRLv",Lv:"FLDv",Rv:"FDRv",Bv:"DLRv",D:"D",F:"F",BL:"L",BR:"R",d:"d",f:"f",bl:"l",br:"r"},kt={U:"FRL",L:"FLD",R:"FDR",B:"DLR"},Et=new $("y"),jt=new $("Dv"),Nt=class{constructor(e){this.child=e}wcaHack=!1;map=ee;notationToInternal(e){if(this.wcaHack&&e.innerLayer===2&&e.outerLayer===null){let s=kt[e.family];if(s)return new R(new $(s,e.innerLayer,e.outerLayer),e.amount)}let t=this.map[e.family];return t?new R(new $(t,e.innerLayer,e.outerLayer),e.amount):Et.isIdentical(e.quantum)?new R(jt,-e.amount):null}notationToExternal(e){if(this.wcaHack&&e.innerLayer===2&&e.outerLayer===null){for(let[t,s]of Object.entries(kt))if(this.child.spinmatch(e.family,s))return new R(new $(t,e.innerLayer,e.outerLayer),e.amount)}for(let[t,s]of Object.entries(this.map))if(this.child.spinmatch(e.family,s))return new R(new $(t,e.innerLayer,e.outerLayer),e.amount);return jt.isIdentical(e.quantum)?new R(Et,-e.amount):null}},ie=class extends Nt{wcaHack=!0;constructor(e){super(e),this.map=se}},Ct={U:"UBL",UL:"ULF",F:"UFR",UR:"URB",B:"DBL",D:"DFR",L:"DLF",R:"DRB",Uv:"UBLv",ULv:"ULFv",Fv:"UFRv",URv:"URBv",Bv:"DBLv",Dv:"DFRv",Lv:"DLFv",Rv:"DRBv"},pt=new $("x"),Ut=new $("Rv"),ne=new $("Lv"),dt=new $("y"),Pt=new $("Uv"),oe=new $("Dv"),gt=new $("z"),Ot=new $("Fv"),re=new $("Bv"),ae=class{constructor(e){this.child=e}notationToInternal(e){if(e.innerLayer||e.outerLayer)return null;let t=Ct[e.family];return t?new R(new $(t,e.outerLayer,e.innerLayer),e.amount):pt.isIdentical(e.quantum)?new R(Ut,e.amount):dt.isIdentical(e.quantum)?new R(Pt,e.amount):gt.isIdentical(e.quantum)?new R(Ot,e.amount):null}notationToExternal(e){for(let[t,s]of Object.entries(Ct))if(this.child.spinmatchv(e.family,s))return new R(new $(t,e.innerLayer,e.outerLayer),e.amount);return Ut.isIdentical(e.quantum)?new R(pt,e.amount):ne.isIdentical(e.quantum)?new R(pt,-e.amount):Pt.isIdentical(e.quantum)?new R(dt,e.amount):oe.isIdentical(e.quantum)?new R(dt,-e.amount):Ot.isIdentical(e.quantum)?new R(gt,e.amount):re.isIdentical(e.quantum)?new R(gt,-e.amount):null}};function le(e,t){let s=Rt(zt({},e),{moves:{}});for(let[i,n]of Object.entries(e.moves)){let o=i,r="";["v","w"].includes(i.at(-1))&&(o=i.slice(0,-1),r=i.slice(-1));let f=t.notationToExternal(R.fromString(o));if(!f)continue;let h=f+r;if(!h)throw new Error(`Missing external move name for: ${i.toString()}`);s.moves[h.toString()]=n}return s}function Ie(e){let t=0,s={};for(;t<e.length&&e[t][0]==="-";){let n=e[t++];if(n==="--rotations")s.addRotations=!0;else if(n==="--allmoves")s.allMoves=!0;else if(n==="--outerblockmoves")s.outerBlockMoves=!0;else if(n==="--vertexmoves")s.vertexMoves=!0;else if(n==="--nocorners")s.includeCornerOrbits=!1;else if(n==="--noedges")s.includeEdgeOrbits=!1;else if(n==="--noorientation")s.fixedOrientation=!0;else if(n==="--nocenters")s.includeCenterOrbits=!1;else if(n==="--omit")s.excludeOrbits=e[t].split(","),t++;else if(n==="--moves")s.moveList=e[t].split(","),t++;else if(n==="--optimize")s.optimizeOrbits=!0;else if(n==="--scramble")s.scrambleAmount=100;else if(n==="--fixcorner")s.fixedPieceType="v";else if(n==="--fixedge")s.fixedPieceType="e";else if(n==="--fixcenter")s.fixedPieceType="f";else if(n==="--orientcenters")s.orientCenters=!0;else if(n==="--puzzleorientation")s.puzzleOrientation=JSON.parse(e[t]),t++;else throw new Error(`Bad option: ${n}`)}return{puzzleDescription:Jt(e.slice(t).join(" ")),options:s}}var he=class{verbosity=0;allMoves=!1;outerBlockMoves;vertexMoves=!1;addRotations=!1;moveList=null;fixedOrientation=!1;fixedPieceType=null;orientCenters=!1;includeCornerOrbits=!0;includeCenterOrbits=!0;includeEdgeOrbits=!0;excludeOrbits=[];optimizeOrbits=!1;grayCorners=!1;grayCenters=!1;grayEdges=!1;puzzleOrientation=null;puzzleOrientations=null;scrambleAmount=0;constructor(e={}){Object.assign(this,e)}},bt=[],wt=[];function it(e){if(!bt[e]){let t=Array(e);for(let s=0;s<e;s++)t[s]=0;bt[e]=t}return bt[e]}function tt(e){if(!wt[e]){let t=Array(e);for(let s=0;s<e;s++)t[s]=s;wt[e]=t}return wt[e]}function ce(e){return new rt(tt(e))}function fe(e){let t=BigInt(1);for(;e>1;)t*=BigInt(e),e--;return t}function ue(e,t){if(e>t){let s=e;e=t,t=s}for(;e>0;){let s=t%e;t=e,e=s}return t}function At(e,t){return e/ue(e,t)*t}var rt=class lt{n;p;constructor(t){this.n=t.length,this.p=t}toString(){return`Perm[${this.p.join(" ")}]`}mul(t){let s=Array(this.n);for(let i=0;i<this.n;i++)s[i]=t.p[this.p[i]];return new lt(s)}rmul(t){let s=Array(this.n);for(let i=0;i<this.n;i++)s[i]=this.p[t.p[i]];return new lt(s)}inv(){let t=Array(this.n);for(let s=0;s<this.n;s++)t[this.p[s]]=s;return new lt(t)}compareTo(t){for(let s=0;s<this.n;s++)if(this.p[s]!==t.p[s])return this.p[s]-t.p[s];return 0}toGap(){let t=new Array,s=new Array(this.n);for(let i=0;i<this.p.length;i++){if(s[i]||this.p[i]===i)continue;let n=new Array;for(let o=this.p[i];!s[o];o=this.p[o])n.push(1+o),s[o]=!0;t.push(`(${n.reverse().join(",")})`)}return t.join("")}toMathematica(){let t=new Array,s=new Array(this.n);for(let i=0;i<this.p.length;i++){if(s[i]||this.p[i]===i)continue;let n=new Array;for(let o=this.p[i];!s[o];o=this.p[o])n.push(1+o),s[o]=!0;t.push(`{${n.reverse().join(",")}}`)}return`Cycles[{${t.join(",")}}]`}order(){let t=1,s=new Array(this.n);for(let i=0;i<this.p.length;i++){if(s[i]||this.p[i]===i)continue;let n=0;for(let o=i;!s[o];o=this.p[o])n++,s[o]=!0;t=At(t,n)}return t}},xt=class{constructor(e,t){this.size=e,this.mod=t}reassemblySize(){return fe(this.size)*BigInt(this.mod)**BigInt(this.size)}},me=0;function ft(e,t){let s=R.fromString(t),i=e.notationToExternal(s);return i===null||s===i?t:i.toString()}var Gt=class Kt{constructor(t,s,i,n,o,r,f){this.orbitnames=t,this.orbitdefs=s,this.solved=i,this.movenames=n,this.moveops=o,this.isRotation=r,this.forcenames=f}toKTransformationData(t){let s={};for(let i=0;i<this.orbitnames.length;i++)s[this.orbitnames[i]]=t.orbits[i].toKTransformationOrbitData();return s}toKPatternData(t){let s={};for(let i=0;i<this.orbitnames.length;i++)s[this.orbitnames[i]]=t.orbits[i].toKPatternOrbitData();return s}static transformToKTransformationData(t,s){let i={};for(let n=0;n<t.length;n++)i[t[n]]=s.orbits[n].toKTransformationOrbitData();return i}describeSet(t,s,i){let n=this.orbitdefs[t].size,o=new Array(n);for(let r=0;r<n;r++)o[r]=[];for(let r=0;r<this.movenames.length;r++){if(this.isRotation[r])continue;let f=this.movenames[r];this.forcenames[r]||(f=ft(i,f),f[f.length-1]==="'"&&(f=f.substring(0,f.length-1)));let h=this.moveops[r].orbits[t];for(let m=0;m<n;m++)(h.perm[m]!==m||h.ori[m]!==0)&&o[m].push(f)}for(let r=0;r<n;r++)s.push(`# ${r+1} ${o[r].join(" ")}`)}toKsolve(t,s=new Tt){let i=[];i.push(`Name ${t}`),i.push("");for(let n=0;n<this.orbitnames.length;n++)i.push(`Set ${this.orbitnames[n]} ${this.orbitdefs[n].size} ${this.orbitdefs[n].mod}`),this.describeSet(n,i,s);i.push(""),i.push("Solved");for(let n=0;n<this.orbitnames.length;n++)this.solved.orbits[n].appendDefinition(i,this.orbitnames[n],!1,!1);i.push("End");for(let n=0;n<this.movenames.length;n++){i.push("");let o=this.movenames[n];this.forcenames[n]||(o=ft(s,this.movenames[n]));let r=!1;o[o.length-1]==="'"&&(r=!0,o=o.substring(0,o.length-1)),i.push(`Move ${o}`);for(let f=0;f<this.orbitnames.length;f++)r?this.moveops[n].orbits[f].inv().appendDefinition(i,this.orbitnames[f],!0):this.moveops[n].orbits[f].appendDefinition(i,this.orbitnames[f],!0);i.push("End")}return i}toKPuzzleDefinition(t){let s=[],i={};for(let o=0;o<this.orbitnames.length;o++){s.push({orbitName:this.orbitnames[o],numPieces:this.orbitdefs[o].size,numOrientations:this.orbitdefs[o].mod});let r=this.solved.orbits[o].toKTransformationOrbitData();i[this.orbitnames[o]]={pieces:r.permutation,orientation:r.orientationDelta}}let n={};if(t)for(let o=0;o<this.movenames.length;o++)n[this.movenames[o]]=this.toKTransformationData(this.moveops[o]);return{name:`PG3D #${++me}`,orbits:s,defaultPattern:i,moves:n}}optimize(){let t=[],s=[],i=[],n=[];for(let o=0;o<this.moveops.length;o++)n.push([]);for(let o=0;o<this.orbitdefs.length;o++){let r=this.orbitdefs[o].mod,f=this.orbitdefs[o].size,h=new $t(f),m=new Array(this.orbitdefs[o].size);for(let u=0;u<f;u++)m[u]=!1;for(let u=0;u<this.moveops.length;u++)for(let a=0;a<f;a++)(this.moveops[u].orbits[o].perm[a]!==a||this.moveops[u].orbits[o].ori[a]!==0)&&(this.isRotation[u]||(m[a]=!0),h.union(a,this.moveops[u].orbits[o].perm[a]));let p=!0;if(r>1){p=!1;let u=new $t(this.orbitdefs[o].size*r);for(let a=0;a<this.moveops.length;a++)for(let l=0;l<f;l++)if(this.moveops[a].orbits[o].perm[l]!==l||this.moveops[a].orbits[o].ori[l]!==0)for(let w=0;w<r;w++)u.union(l*r+w,this.moveops[a].orbits[o].perm[l]*r+(w+this.moveops[a].orbits[o].ori[l])%r);for(let a=0;!p&&a<f;a++)for(let l=1;l<r;l++)u.find(a*r)===u.find(a*r+l)&&(p=!0);for(let a=0;!p&&a<f;a++)for(let l=0;l<a;l++)this.solved.orbits[o].perm[a]===this.solved.orbits[o].perm[l]&&(p=!0)}let d=-1,y=!1;for(let u=0;u<this.orbitdefs[o].size;u++)if(m[u]){let a=h.find(u);d<0?d=a:d!==a&&(y=!0)}for(let u=0;u<this.orbitdefs[o].size;u++){if(!m[u]||h.find(u)!==u)continue;let l=[],w=[],F=0;for(let b=0;b<this.orbitdefs[o].size;b++)h.find(b)===u&&(l[F]=b,w[b]=F,F++);if(y?t.push(`${this.orbitnames[o]}_p${u}`):t.push(this.orbitnames[o]),p){s.push(new xt(F,this.orbitdefs[o].mod)),i.push(this.solved.orbits[o].remapVS(l,F));for(let b=0;b<this.moveops.length;b++)n[b].push(this.moveops[b].orbits[o].remap(l,w,F))}else{s.push(new xt(F,1)),i.push(this.solved.orbits[o].remapVS(l,F).killOri());for(let b=0;b<this.moveops.length;b++)n[b].push(this.moveops[b].orbits[o].remap(l,w,F).killOri())}}}return new Kt(t,s,new Zt(i),this.movenames,n.map(o=>new Ht(o)),this.isRotation,this.forcenames)}scramble(t){this.solved=this.solved.mul(this.getScrambleTransformation(t))}getScrambleTransformation(t){t<100&&(t=100);let s=[];for(let n=0;n<this.moveops.length;n++)s[n]=this.moveops[n];for(let n=0;n<s.length;n++){let o=Math.floor(Math.random()*s.length),r=s[n];s[n]=s[o],s[o]=r}t<s.length&&(t=s.length);for(let n=0;n<t;n++){let o=Math.floor(Math.random()*s.length),r=Math.floor(Math.random()*s.length),f=Math.floor(Math.random()*this.moveops.length);s[o]=s[o].mul(s[r]).mul(this.moveops[f]),Math.random()<.1&&(s[o]=s[o].mul(this.moveops[f]))}let i=s[0];for(let n=1;n<s.length;n++)i=i.mul(s[n]);return i}reassemblySize(){let t=BigInt(1);for(let s=0;s<this.orbitdefs.length;s++)t*=this.orbitdefs[s].reassemblySize();return t}},nt=class X{constructor(t,s,i){this.perm=t,this.ori=s,this.orimod=i}static ktransformationCache=[];static e(t,s){return new X(tt(t),it(t),s)}mul(t){let s=this.perm.length,i=new Array(s);if(this.orimod===1){for(let n=0;n<s;n++)i[n]=this.perm[t.perm[n]];return new X(i,this.ori,this.orimod)}else{let n=new Array(s);for(let o=0;o<s;o++)i[o]=this.perm[t.perm[o]],n[o]=(this.ori[t.perm[o]]+t.ori[o])%this.orimod;return new X(i,n,this.orimod)}}inv(){let t=this.perm.length,s=new Array(t),i=new Array(t);for(let n=0;n<t;n++)s[this.perm[n]]=n,i[this.perm[n]]=(this.orimod-this.ori[n])%this.orimod;return new X(s,i,this.orimod)}equal(t){let s=this.perm.length;for(let i=0;i<s;i++)if(this.perm[i]!==t.perm[i]||this.ori[i]!==t.ori[i])return!1;return!0}killOri(){let t=this.perm.length;for(let s=0;s<t;s++)this.ori[s]=0;return this.orimod=1,this}toPerm(){let t=this.orimod;if(t===1)return new rt(this.perm);let s=this.perm.length,i=new Array(s*t);for(let n=0;n<s;n++)for(let o=0;o<t;o++)i[n*t+o]=t*this.perm[n]+(this.ori[n]+o)%t;return new rt(i)}identicalPieces(){let t=[],s=this.perm.length,i=[];for(let n=0;n<s;n++){let o=this.perm[n];if(t[o]===void 0){let r=[n];t[o]=!0;for(let f=n+1;f<s;f++)this.perm[f]===o&&r.push(f);i.push(r)}}return i}order(){return this.toPerm().order()}isIdentity(){let t=this.perm.length;if(this.perm===tt(t)&&this.ori===it(t))return!0;for(let s=0;s<t;s++)if(this.perm[s]!==s||this.ori[s]!==0)return!1;return!0}zeroOris(){let t=this.perm.length;if(this.ori===it(t))return!0;for(let s=0;s<t;s++)if(this.ori[s]!==0)return!1;return!0}remap(t,s,i){let n=new Array(i),o=new Array(i);for(let r=0;r<i;r++)n[r]=s[this.perm[t[r]]],o[r]=this.ori[t[r]];return new X(n,o,this.orimod)}remapVS(t,s){let i=new Array(s),n=new Array(s),o=0,r=[];for(let f=0;f<s;f++){let h=this.perm[t[f]];r[h]===void 0&&(r[h]=o++),i[f]=r[h],n[f]=this.ori[t[f]]}return new X(i,n,this.orimod)}appendDefinition(t,s,i,n=!0){if(!(n&&this.isIdentity())&&(t.push(s),t.push(this.perm.map(o=>o+1).join(" ")),!this.zeroOris()))if(i){let o=new Array(this.ori.length);for(let r=0;r<o.length;r++)o[this.perm[r]]=this.ori[r];t.push(o.join(" "))}else t.push(this.ori.join(" "))}toKTransformationOrbitData(){let t=this.perm.length;return this.isIdentity()?(X.ktransformationCache[t]||(X.ktransformationCache[t]={permutation:tt(t),orientationDelta:it(t)}),X.ktransformationCache[t]):{permutation:this.perm,orientationDelta:this.ori}}toKPatternOrbitData(){let t=this.perm.length;return{pieces:this.perm,orientation:this.ori,orientationMod:it(t)}}},Qt=class{constructor(e){this.orbits=e}internalMul(e){let t=[];for(let s=0;s<this.orbits.length;s++)t.push(this.orbits[s].mul(e.orbits[s]));return t}internalInv(){let e=[];for(let t of this.orbits)e.push(t.inv());return e}equal(e){for(let t=0;t<this.orbits.length;t++)if(!this.orbits[t].equal(e.orbits[t]))return!1;return!0}killOri(){for(let e of this.orbits)e.killOri();return this}toPerm(){let e=new Array,t=0;for(let i of this.orbits){let n=i.toPerm();e.push(n),t+=n.n}let s=new Array(t);t=0;for(let i of e){for(let n=0;n<i.n;n++)s[t+n]=t+i.p[n];t+=i.n}return new rt(s)}identicalPieces(){let e=[],t=0;for(let s of this.orbits){let i=s.orimod,n=s.identicalPieces();for(let o=0;o<n.length;o++)e.push(n[o].map(r=>r*i+t));t+=i*s.perm.length}return e}order(){let e=1;for(let t of this.orbits)e=At(e,t.order());return e}},Ht=class ht extends Qt{mul(t){return new ht(this.internalMul(t))}mulScalar(t){if(t===0)return this.e();let s=this;for(t<0&&(s=s.inv(),t=-t);!(t&1);)s=s.mul(s),t>>=1;if(t===1)return s;let i=s,n=this.e();for(;t>0;)t&1&&(n=n.mul(i)),t>1&&(i=i.mul(i)),t>>=1;return n}inv(){return new ht(this.internalInv())}e(){return new ht(this.orbits.map(t=>nt.e(t.perm.length,t.orimod)))}},Zt=class Wt extends Qt{mul(t){return new Wt(this.internalMul(t))}},$t=class{constructor(e){this.n=e,this.heads=new Array(e);for(let t=0;t<e;t++)this.heads[t]=t}heads;find(e){let t=this.heads[e];return this.heads[t]===t||(t=this.find(this.heads[t]),this.heads[e]=t),t}union(e,t){let s=this.find(e),i=this.find(t);s<i?this.heads[i]=s:s>i&&(this.heads[s]=i)}};function pe(e,t){let s=e.moveops.length;if(s>30)throw new Error("Canon info too big for bitmask");let i=[],n=[];for(let r=0;r<s;r++){let f=e.moveops[r];i.push(f.order());let h=0;for(let m=0;m<s;m++){if(m===r)continue;let p=e.moveops[m];f.mul(p).equal(p.mul(f))&&(h|=1<<m)}n.push(h)}let o={};o[0]=1;for(let r=0;r<100;r++){let f=0,h={},m=0;for(let p in o){let d=+p,y=o[d];f+=y,m++;for(let u=0;u<i.length;u++)if(!(d>>u&1)&&!(d&n[u]&(1<<u)-1)){let a=d&n[u]|1<<u;h[a]===void 0&&(h[a]=0),h[a]+=(i[u]-1)*y}}t(`${r}: canonseq ${f} states ${m}`),o=h}}var Mt={"2x2x2":"c f 0","3x3x3":"c f 0.333333333333333","4x4x4":"c f 0.5 f 0","5x5x5":"c f 0.6 f 0.2","6x6x6":"c f 0.666666666666667 f 0.333333333333333 f 0","7x7x7":"c f 0.714285714285714 f 0.428571428571429 f 0.142857142857143","8x8x8":"c f 0.75 f 0.5 f 0.25 f 0","9x9x9":"c f 0.777777777777778 f 0.555555555555556 f 0.333333333333333 f 0.111111111111111","10x10x10":"c f 0.8 f 0.6 f 0.4 f 0.2 f 0","11x11x11":"c f 0.818181818181818 f 0.636363636363636 f 0.454545454545455 f 0.272727272727273 f 0.0909090909090909","12x12x12":"c f 0.833333333333333 f 0.666666666666667 f 0.5 f 0.333333333333333 f 0.166666666666667 f 0","13x13x13":"c f 0.846153846153846 f 0.692307692307692 f 0.538461538461538 f 0.384615384615385 f 0.230769230769231 f 0.0769230769230769","20x20x20":"c f 0 f .1 f .2 f .3 f .4 f .5 f .6 f .7 f .8 f .9","30x30x30":"c f 0 f .066667 f .133333 f .2 f .266667 f .333333 f .4 f .466667 f .533333 f .6 f .666667 f .733333 f .8 f .866667 f .933333","40x40x40":"c f 0 f .05 f .1 f .15 f .2 f .25 f .3 f .35 f .4 f .45 f .5 f .55 f .6 f .65 f .7 f .75 f .8 f .85 f .9 f .95",skewb:"c v 0","master skewb":"c v 0.275","professor skewb":"c v 0 v 0.38","compy cube":"c v 0.915641442663986",helicopter:"c e 0.707106781186547","curvy copter":"c e 0.83",dino:"c v 0.577350269189626","little chop":"c e 0",pyramorphix:"t e 0",mastermorphix:"t e 0.346184634065199",pyraminx:"t v 0.333333333333333 v 1.66666666666667",tetraminx:"t v 0.333333333333333","master pyraminx":"t v 0 v 1 v 2","master tetraminx":"t v 0 v 1","professor pyraminx":"t v -0.2 v 0.6 v 1.4 v 2.2","professor tetraminx":"t v -0.2 v 0.6 v 1.4","royal pyraminx":"t v -0.333333333333333 v 0.333333333333333 v 1 v 1.66666666666667 v 2.33333333333333","royal tetraminx":"t v -0.333333333333333 v 0.333333333333333 v 1 v 1.66666666666667","emperor pyraminx":"t v -0.428571428571429 v 0.142857142857143 v 0.714285714285714 v 1.28571428571429 v 1.85714285714286 v 2.42857142857143","emperor tetraminx":"t v -0.428571428571429 v 0.142857142857143 v 0.714285714285714 v 1.28571428571429 v 1.85714285714286","Jing pyraminx":"t f 0","master pyramorphix":"t e 0.866025403784437",megaminx:"d f 0.7",gigaminx:"d f 0.64 f 0.82",teraminx:"d f 0.64 f 0.76 f 0.88",petaminx:"d f 0.64 f 0.73 f 0.82 f 0.91",examinx:"d f 0.64 f 0.712 f 0.784 f 0.856 f 0.928",zetaminx:"d f 0.64 f 0.7 f 0.76 f 0.82 f 0.88 f 0.94",yottaminx:"d f 0.64 f 0.6914 f 0.7429 f 0.7943 f 0.8457 f 0.8971 f 0.9486",pentultimate:"d f 0","master pentultimate":"d f 0.1","elite pentultimate":"d f 0 f 0.145905",starminx:"d v 0.937962370425399","starminx 2":"d f 0.23606797749979","pyraminx crystal":"d f 0.447213595499989",chopasaurus:"d v 0","big chop":"d e 0","skewb diamond":"o f 0",FTO:"o f 0.333333333333333","master FTO":"o f 0.5 f 0","Christopher's jewel":"o v 0.577350269189626",octastar:"o e 0","Trajber's octahedron":"o v 0.433012701892219","radio chop":"i f 0",icosamate:"i v 0","icosahedron 2":"i v 0.18759247376021","icosahedron 3":"i v 0.18759247376021 e 0","icosahedron static faces":"i v 0.84","icosahedron moving faces":"i v 0.73","Eitan's star":"i f 0.61803398874989","2x2x2 + dino":"c f 0 v 0.577350269189626","2x2x2 + little chop":"c f 0 e 0","dino + little chop":"c v 0.577350269189626 e 0","2x2x2 + dino + little chop":"c f 0 v 0.577350269189626 e 0","megaminx + chopasaurus":"d f 0.61803398875 v 0","starminx combo":"d f 0.23606797749979 v 0.937962370425399"},st=1e-9;function vt(e){let t=new A(0,0,0,0);for(let s=0;s<e.length;s++)t=t.sum(e[s]);return t.smul(1/e.length)}function de(e,t,s,i){let n=i[e].intersect3(i[t],i[s]);if(!n)return n;for(let o=0;o<i.length;o++)if(o!==e&&o!==t&&o!==s){let r=i[o].b*n.b+i[o].c*n.c+i[o].d*n.d;if(i[o].a>0&&r>i[o].a||i[o].a<0&&r<i[o].a)return!1}return n}var A=class V{constructor(t,s,i,n){this.a=t,this.b=s,this.c=i,this.d=n}mul(t){return new V(this.a*t.a-this.b*t.b-this.c*t.c-this.d*t.d,this.a*t.b+this.b*t.a+this.c*t.d-this.d*t.c,this.a*t.c-this.b*t.d+this.c*t.a+this.d*t.b,this.a*t.d+this.b*t.c-this.c*t.b+this.d*t.a)}toString(){return`Q[${this.a},${this.b},${this.c},${this.d}]`}dist(t){return Math.hypot(this.a-t.a,this.b-t.b,this.c-t.c,this.d-t.d)}len(){return Math.hypot(this.a,this.b,this.c,this.d)}cross(t){return new V(0,this.c*t.d-this.d*t.c,this.d*t.b-this.b*t.d,this.b*t.c-this.c*t.b)}dot(t){return this.b*t.b+this.c*t.c+this.d*t.d}normalize(){let t=Math.sqrt(this.dot(this));return new V(this.a/t,this.b/t,this.c/t,this.d/t)}makenormal(){return new V(0,this.b,this.c,this.d).normalize()}normalizeplane(){let t=Math.hypot(this.b,this.c,this.d);return new V(this.a/t,this.b/t,this.c/t,this.d/t)}smul(t){return new V(this.a*t,this.b*t,this.c*t,this.d*t)}sum(t){return new V(this.a+t.a,this.b+t.b,this.c+t.c,this.d+t.d)}sub(t){return new V(this.a-t.a,this.b-t.b,this.c-t.c,this.d-t.d)}angle(){return 2*Math.acos(this.a)}invrot(){return new V(this.a,-this.b,-this.c,-this.d)}det3x3(t,s,i,n,o,r,f,h,m){return t*(o*m-r*h)+s*(r*f-n*m)+i*(n*h-o*f)}rotateplane(t){let s=t.mul(new V(0,this.b,this.c,this.d)).mul(t.invrot());return s.a=this.a,s}orthogonal(){let t=Math.abs(this.b),s=Math.abs(this.c),i=Math.abs(this.d);return t<s&&t<i?this.cross(new V(0,1,0,0)).normalize():s<t&&s<i?this.cross(new V(0,0,1,0)).normalize():this.cross(new V(0,0,0,1)).normalize()}pointrotation(t){let s=this.normalize();if(t=t.normalize(),s.sub(t).len()<st)return new V(1,0,0,0);let i=s.sum(t);i.len()<st?i=i.orthogonal():i=i.normalize();let n=s.cross(i);return n.a=s.dot(i),n}unproject(t){return this.sum(t.smul(-this.dot(t)/(this.len()*t.len())))}rotatepoint(t){return t.mul(this).mul(t.invrot())}rotateface(t){return t.map(s=>s.rotatepoint(this))}intersect3(t,s){let i=this.det3x3(this.b,this.c,this.d,t.b,t.c,t.d,s.b,s.c,s.d);return Math.abs(i)<st?!1:new V(0,this.det3x3(this.a,this.c,this.d,t.a,t.c,t.d,s.a,s.c,s.d)/i,this.det3x3(this.b,this.a,this.d,t.b,t.a,t.d,s.b,s.a,s.d)/i,this.det3x3(this.b,this.c,this.a,t.b,t.c,t.a,s.b,s.c,s.a)/i)}side(t){return t>st?1:t<-st?-1:0}cutface(t){let s=this.a,i=0,n=null;for(let o=0;o<t.length;o++)i|=1<<this.side(t[o].dot(this)-s)+1;if((i&5)===5){n=[];let o=t.map(r=>this.side(r.dot(this)-s));for(let r=-1;r<=1;r+=2){let f=[];for(let h=0;h<t.length;h++){(o[h]===r||o[h]===0)&&f.push(t[h]);let m=(h+1)%t.length;if(o[h]+o[m]===0&&o[h]!==0){let p=t[h].dot(this)-s,d=t[m].dot(this)-s,y=p/(p-d),u=t[h].smul(1-y).sum(t[m].smul(y));f.push(u)}}n.push(f)}}return n}cutfaces(t){let s=[];for(let i=0;i<t.length;i++){let n=t[i],o=this.cutface(n);o?(s.push(o[0]),s.push(o[1])):s.push(n)}return s}faceside(t){let s=this.a;for(let i=0;i<t.length;i++){let n=this.side(t[i].dot(this)-s);if(n!==0)return n}throw new Error("Could not determine side of plane in faceside")}sameplane(t){let s=this.normalize(),i=t.normalize();return s.dist(i)<st||s.dist(i.smul(-1))<st}makecut(t){return new V(t,this.b,this.c,this.d)}},ut=1e-9;function ge(){let e=Math.sqrt(.5);return[new A(e,e,0,0),new A(e,0,e,0)]}function be(){return[new A(.5,.5,.5,.5),new A(.5,.5,.5,-.5)]}function we(){let e=2*Math.PI/10,t=.5+.3*Math.sqrt(5),s=.5+.1*Math.sqrt(5),i=Math.sqrt(t*t+s*s);return t/=i,s/=i,[new A(Math.cos(e),t*Math.sin(e),s*Math.sin(e),0),new A(.5,.5,.5,.5)]}function ve(){let e=.16666666666666666+Math.sqrt(5)/6,t=2/3+Math.sqrt(5)/3,s=Math.sqrt(e*e+t*t);e/=s,t/=s;let i=2*Math.PI/6;return[new A(Math.cos(i),e*Math.sin(i),t*Math.sin(i),0),new A(Math.cos(i),-e*Math.sin(i),t*Math.sin(i),0)]}function ye(){let e=Math.sqrt(.5);return[new A(.5,.5,.5,.5),new A(e,0,0,e)]}function xe(e){let t=[new A(1,0,0,0)];for(let s=0;s<t.length;s++)for(let i=0;i<e.length;i++){let n=e[i].mul(t[s]),o=n.smul(-1),r=!1;for(let f=0;f<t.length;f++)if(n.dist(t[f])<ut||o.dist(t[f])<ut){r=!0;break}r||t.push(n)}return t}function It(e,t){let s=[],i=[];for(let n=0;n<t.length;n++){let o=e.rotateplane(t[n]),r=!1;for(let f=0;f<s.length;f++)if(o.dist(s[f])<ut){r=!0;break}r||(s.push(o),i.push(t[n]))}return i}function St(e){let t=[];for(let s=1;s<e.length;s++)for(let i=s+1;i<e.length;i++){let n=de(0,s,i,e);if(n){let o=!1;for(let r=0;r<t.length;r++)if(n.dist(t[r])<ut){o=!0;break}o||t.push(n)}}for(;;){let s=!1;for(let i=0;i<t.length;i++){let n=(i+1)%t.length;if(e[0].dot(t[i].cross(t[n]))<0){let o=t[i];t[i]=t[n],t[n]=o,s=!0}}if(!s)break}return t}var Le=class{mult;constructor(){this.mult=[]}multiply(e){for(let t=2;t*t<=e;t++)for(;e%t===0;)this.mult[t]!==void 0?this.mult[t]++:this.mult[t]=1,e/=t;e>1&&(this.mult[e]!==void 0?this.mult[e]++:this.mult[e]=1)}toString(){let e="";for(let t=0;t<this.mult.length;t++)this.mult[t]!==void 0&&(e!==""&&(e+="*"),e+=t,this.mult[t]>1&&(e+=`^${this.mult[t]}`));return e}};function Fe(e,t){let s=e[0].p.length,i=ce(s),n=[],o=[],r=[],f=[],h=[];function m(u){for(let a=u.p.length-1;a>=0;a--){let l=u.p[a];if(l!==a){if(!n[a][l])return!1;u=u.mul(o[a][l])}}return!0}function p(u,a,l){f[u].push(a),h[u].push(l);for(let w=0;w<n[u].length;w++)n[u][w]&&d(u,n[u][w].mul(a),l+r[u][w])}function d(u,a,l){let w=a.p[u];if(!n[u][w]){n[u][w]=a,o[u][w]=a.inv(),r[u][w]=l;for(let b=0;b<f[u].length;b++)d(u,a.mul(f[u][b]),l+h[u][b]);return}let F=a.mul(o[u][w]);m(F)||p(u-1,F,l+r[u][w])}function y(){n=[],o=[],f=[],r=[],h=[];for(let l=0;l<s;l++)n.push([]),o.push([]),r.push([]),f.push([]),h.push([]),n[l][l]=i,o[l][l]=i,r[l][l]=0;let u=0,a=BigInt(1);for(let l=0;l<e.length;l++){p(s-1,e[l],1),a=BigInt(1);let w=0,F=0,b=[],B=new Le;for(let M=0;M<s;M++){let O=0,Q=0;for(let C=0;C<s;C++)n[M][C]&&(O++,Q+=r[M][C],M!==C&&u++);w+=f[M].length,a*=BigInt(O),O>1&&B.multiply(O);let T=Q/O;b.push(T),F+=T}t(`${l}: sz ${a} T ${w} sol ${F} none ${u} mults ${B.toString()}`)}return a}return y()}var Lt=class Ft{coords;length;constructor(t){this.coords=new Array(t.length*3);for(let s=0;s<t.length;s++)this.coords[3*s]=t[s].b,this.coords[3*s+1]=t[s].c,this.coords[3*s+2]=t[s].d;this.length=t.length}get(t){return new A(0,this.coords[3*t],this.coords[3*t+1],this.coords[3*t+2])}centermass(){let t=0,s=0,i=0;for(let n=0;n<this.length;n++)t+=this.coords[3*n],s+=this.coords[3*n+1],i+=this.coords[3*n+2];return new A(0,t/this.length,s/this.length,i/this.length)}rotate(t){let s=[];for(let i=0;i<this.length;i++)s.push(this.get(i).rotatepoint(t));return new Ft(s)}rotateforward(){let t=[];for(let s=1;s<this.length;s++)t.push(this.get(s));return t.push(this.get(0)),new Ft(t)}},Be=class Bt{constructor(t,s,i){this.face=t,this.left=s,this.right=i}split(t){let s=t.cutface(this.face);return s!==null&&(this.left===void 0?(this.left=new Bt(s[0]),this.right=new Bt(s[1])):(this.left=this.left?.split(t),this.right=this.right?.split(t))),this}collect(t,s){return this.left===void 0?t.push(new Lt(this.face)):s?(this.left?.collect(t,!1),this.right?.collect(t,!0)):(this.right?.collect(t,!1),this.left?.collect(t,!0)),t}};function Me(e,t){let s=[];for(let i of e)for(let n of t)s.push(n.rotate(i));return s}var G=1e-9,ze="PuzzleGeometry 0.1 Copyright 2018 Tomas Rokicki.",Re=!1;function De(){return{4:[["F","D","L","R"]],6:[["F","D","L","U","R"],["R","F","","B",""]],8:[["F","D","L","R"],["D","F","BR",""],["BR","D","","BB"],["BB","BR","U","BL"]],12:[["U","F","","","",""],["F","U","R","C","A","L"],["R","F","","","E",""],["E","R","","BF","",""],["BF","E","BR","BL","I","D"]],20:[["R","C","F","E"],["F","R","L","U"],["L","F","A",""],["E","R","G","I"],["I","E","S","H"],["S","I","J","B"],["B","S","K","D"],["K","B","M","O"],["O","K","P","N"],["P","O","Q",""]]}}function ke(){return{4:{F:"#44ee00",D:"#f4f400",L:"#ff0000",R:"#2266ff"},6:{U:"#ffffff",F:"#44ee00",R:"#ff0000",D:"#f4f400",B:"#2266ff",L:"#ff8000"},8:{U:"#ffffff",F:"#44ee00",R:"#ff0000",D:"#f4f400",BB:"#2266ff",L:"#8800dd",BL:"#ff8000",BR:"#aaaaaa"},12:{U:"#ffffff",F:"#008800",R:"#ff0000",C:"#e8d0a0",A:"#3399ff",L:"#8800dd",E:"#ff66cc",BF:"#99ff00",BR:"#0000ff",BL:"#f4f400",I:"#ff8000",D:"#aaaaaa"},20:{R:"#db69f0",C:"#178fde",F:"#23238b",E:"#9cc726",L:"#2c212d",U:"#177fa7",A:"#e0de7f",G:"#2b57c0",I:"#41126b",S:"#4b8c28",H:"#7c098d",J:"#7fe7b4",B:"#85fb74",K:"#3f4bc3",D:"#0ff555",M:"#f1c2c8",O:"#58d340",P:"#c514f2",N:"#14494e",Q:"#8b1be1"}}}var Ee={4:{v:["DFR","DLF","DRL","FLR"],e:["FR","LF","DF","DL","RD","RL"],c:["DF","FD","RL","LR"]},6:{v:["URF","UBR","ULB","UFL","DFR","DRB","DBL","DLF"],e:["UF","UR","UB","UL","DF","DR","DB","DL","FR","FL","BR","BL"],c:["UB","LU","FU","RU","BU","DF"]},8:{v:["UBBBRR","URFL","ULBLBB","DBRBBBL","DBLLF","DFRBR"],e:["UL","UBB","UR","BRD","BLD","FD","BRR","FR","FL","BLL","BLBB","BRBB"],c:["BBU","LU","RU","BRD","FD","BLD","DF","UBB"]},12:{v:["URF","UFL","ULBL","UBLBR","UBRR","DEBF","DBFI","DIA","DAC","DCE","LAI","ALF","FCA","CFR","REC","ERBR","BRBFE","BFBRBL","BLIBF","IBLL"],e:["UF","UR","UBR","UBL","UL","ER","EBR","EBF","ED","EC","IBF","IBL","IL","IA","ID","AC","CF","FA","BFBR","BRBL","BLBF","CD","AD","AL","FL","FR","CR","BFD","BRR","BLL"],c:["UF","FU","DBF","BFD","AD","CD","BRU","BLU","LA","RA","EBR","IBL"]},20:{v:["FLPQU","FUGER","FRCAL","HCREI","ISBDH","JSIEG","BSJMK","MQPOK","ONDBK","NOPLA","UQMJG","DNACH"],e:["FU","FL","FR","EG","ER","EI","SJ","SI","SB","KM","KB","KO","PQ","PO","PL","UG","JG","MQ","UQ","HC","HD","ND","NA","JM","CA","AL","CR","HI","DB","NO"],c:["FU","UF","GE","EG","JS","SJ","MK","KM","QP","PQ","LA","AL","RC","CR","IH","HI","BD","DB","ON","NO"]}};function je(){return{4:[["FLR",[0,1,0]],["F",[0,0,1]]],6:[["U",[0,1,0]],["F",[0,0,1]]],8:[["U",[0,1,0]],["F",[0,0,1]]],12:[["U",[0,1,0]],["F",[0,0,1]]],20:[["GUQMJ",[0,1,0]],["F",[0,0,1]]]}}function at(e,t){for(let s=0;s<e.length;s++)if(e[s][0].dist(t)<G)return s;throw new Error("Element not found")}function Se(){return Mt}function Te(e){return Mt[e]}var Ne=["c","t","o","d","i"],Ae=["f","v","e"];function Jt(e){let t=e.split(/ /).filter(Boolean);if(t.length%2===0)return null;let s=t[0];if(s!=="o"&&s!=="c"&&s!=="i"&&s!=="d"&&s!=="t")return null;let i=[];for(let n=1;n<t.length;n+=2){if(t[n]!=="f"&&t[n]!=="v"&&t[n]!=="e")return null;i.push({cutType:t[n],distance:parseFloat(t[n+1])})}return{shape:s,cuts:i}}function Ce(e,t={}){let s=Jt(e);if(s===null)throw new Error("Could not parse the puzzle description");let i=new Oe(s,Object.assign({},{allMoves:!0},t));return i.allstickers(),i.genperms(),i}function Ge(e,t){return Ce(Mt[e],t)}function Ue(e,t,s){let i=!1;s-t[1]<t[0]&&(e=[e[2],e[3],e[0],e[1]],t=[s-t[1],s-t[0]],i=!0);let n=e[0],o="";if(t[0]===0&&t[1]===s)n=`${n}v`;else if(t[0]===t[1])t[1]>0&&(o=String(t[1]+1));else if(t[0]===0)n=n.toLowerCase(),t[1]>1&&(o=String(t[1]+1));else throw new Error(`We only support slice and outer block moves right now. ${t}`);return[o+n,i]}function Pe(e,t){let s=[],i=0;for(;i<e.length;){i>0&&i<e.length&&e[i]==="_"&&i++;let n="";for(let o of t)e.substr(i).startsWith(o[1])&&o[1].length>n.length&&(n=o[1]);if(n!=="")s.push(n),i+=n.length;else throw new Error(`Could not split ${e} into face names.`)}return s}function ct(e,t){return[e.b/t,-e.c/t,e.d/t]}function yt(e,t){let s=[],i=e.length;for(let n=0;n<i;n++){let o=ct(e.get(i-n-1),t);s[3*n]=o[0],s[3*n+1]=o[1],s[3*n+2]=o[2]}return s}var Oe=class{constructor(e,t){this.puzzleDescription=e;let s="genperms";this.options=new he(t),this.options.verbosity>0&&console.log(this.header("# ")),this.create(e)}rotations;baseplanerot;baseplanes;facenames;faceplanes;edgenames;vertexnames;geonormals;moveplanes;moveplanes2;moveplanesets;moveplanenormals;movesetorders;movesetgeos;basefaces;faces;facecentermass;baseFaceCount;stickersperface;shortedge;markedface;cubies;vertexdistance;edgedistance;facetocubie;facetoord;moverotations;facelisthash;cubiesetnames;cubieords;cubiesetnums;cubieordnums;orbitoris;cubievaluemap;cubiesetcubies;cmovesbyslice=[];parsedmovelist;duplicatedFaces=[];duplicatedCubies=[];fixedCubie=-1;net=[];colors=[];swizzler;notationMapper=new Tt;addNotationMapper="";setReidOrder=!1;options;create(e){let{shape:t,cuts:s}=e;this.moveplanes=[],this.moveplanes2=[],this.faces=[],this.cubies=[];let i=null;switch(t){case"c":{i=ge();break}case"o":{i=ye();break}case"i":{i=ve();break}case"t":{i=be();break}case"d":{i=we();break}default:throw new Error(`Bad shape argument: ${t}`)}this.rotations=xe(i),this.options.verbosity&&console.log(`# Rotations: ${this.rotations.length}`);let n=i[0];this.baseplanerot=It(n,this.rotations);let o=this.baseplanerot.map(c=>n.rotateplane(c));this.baseplanes=o,this.baseFaceCount=o.length;let r=De()[o.length];this.net=r,this.colors=ke()[o.length],this.options.verbosity>0&&console.log(`# Base planes: ${o.length}`);let f=St(o),h=new A(0,0,0,0);this.options.verbosity>0&&console.log(`# Face vertices: ${f.length}`);let m=o[0].makenormal(),p=f[0].sum(f[1]).makenormal(),d=f[0].makenormal(),y=new A(1,m.b,m.c,m.d);this.options.verbosity>0&&console.log(`# Boundary is ${y}`);let a=It(y,this.rotations).map(c=>y.rotateplane(c)),l=St(a);this.edgedistance=l[0].sum(l[1]).smul(.5).dist(h),this.vertexdistance=l[0].dist(h);let w=[],F=[],b=!1,B=!1,M=!1;for(let c of s){let L=null,E=0;switch(c.cutType){case"f":{L=m,E=1,b=!0;break}case"v":{L=d,E=this.vertexdistance,M=!0;break}case"e":{L=p,E=this.edgedistance,B=!0;break}default:throw new Error(`Bad cut argument: ${c.cutType}`)}w.push(L.makecut(c.distance)),F.push(c.distance<E)}this.options.addRotations&&(b||w.push(m.makecut(10)),M||w.push(d.makecut(10)),B||w.push(p.makecut(10))),this.basefaces=[];for(let c of this.baseplanerot){let L=c.rotateface(l);this.basefaces.push(new Lt(L))}let O=[],Q=[],T=[],C=[],g=l.length;function z(c,L,E){for(let D of c)if(D[0].dist(L)<G){D.push(E);return}c.push([L,E])}for(let c=0;c<this.baseplanerot.length;c++){let L=this.baseplanerot[c].rotateface(l);for(let E=0;E<L.length;E++){let D=(E+1)%L.length,I=L[E].sum(L[D]).smul(.5);z(C,I,c)}}let j=[];for(let c=0;c<this.baseplanerot.length;c++){let L=this.baseplanerot[c].rotateface(l),E=[];for(let D=0;D<L.length;D++){let I=(D+1)%L.length,S=L[D].sum(L[I]).smul(.5),W=C[at(C,S)];if(c===W[1])E.push(W[2]);else if(c===W[2])E.push(W[1]);else throw new Error("Could not find edge")}j.push(E)}let v={},x=[];x.push(r[0][0]),v[r[0][0]]=0,x[j[0][0]]=r[0][1],v[r[0][1]]=j[0][0];for(let c of r){let L=c[0],E=v[L];if(E===void 0)throw new Error("Bad edge description; first edge not connected");let D=-1;for(let I=0;I<j[E].length;I++){let S=x[j[E][I]];if(S!==void 0&&S===c[1]){D=I;break}}if(D<0)throw new Error("First element of a net not known");for(let I=2;I<c.length;I++){if(c[I]==="")continue;let S=j[E][(I+D-1)%g],W=x[S];if(W!==void 0&&W!==c[I])throw new Error("Face mismatch in net");x[S]=c[I],v[c[I]]=S}}for(let c=0;c<this.baseplanerot.length;c++){let L=this.baseplanerot[c].rotateface(l),E=y.rotateplane(this.baseplanerot[c]),D=x[c];O.push([L,D]),Q.push([E,D])}for(let c=0;c<this.baseplanerot.length;c++){let L=this.baseplanerot[c].rotateface(l),E=x[c];for(let D=0;D<L.length;D++){let I=(D+1)%L.length,S=L[D].sum(L[I]).smul(.5),W=(D+2)%L.length,Vt=L[I].sum(L[W]).smul(.5),Yt=at(C,S),Xt=at(C,Vt);z(T,L[I],[E,Xt,Yt])}}this.swizzler=new mt(O.map(c=>c[1]));let k=this.swizzler.prefixFree?"":"_",U=Ee[this.baseFaceCount],P=[];for(let c=0;c<this.baseFaceCount;c++)P[1<<c]=c;{let c=U.v;for(let L of c){let E=this.swizzler.splitByFaceNames(L),D=0;for(let I of E)D|=1<<I;P[D]=E[0]}}{let c=U.e;for(let L of c){let E=this.swizzler.splitByFaceNames(L),D=0;for(let I of E)D|=1<<I;P[D]=E[0]}}{let c=U.c;for(let L of c){let E=this.swizzler.splitByFaceNames(L),D=1<<E[0]|1<<this.baseFaceCount;P[D]=E[1]}}for(let c=0;c<C.length;c++){if(C[c].length!==3)throw new Error(`Bad length in edge names ${C[c]}`);let L=C[c][1],E=C[c][2],D=x[L],I=x[E],S=1<<L|1<<E;P[S]===L?D=D+k+I:D=I+k+D,C[c]=[C[c][0],D]}for(let c=0;c<T.length;c++){let L=0;if(T[c].length<4)throw new Error("Bad length in vertex names");for(let S=1;S<T[c].length;S++)L|=1<<v[T[c][S][0]];let E=P[L],D=-1;for(let S=1;S<T[c].length;S++)E===v[T[c][S][0]]&&(D=S);if(D<0)throw new Error("Internal error; couldn't find face name when fixing corners");let I="";for(let S=1;S<T[c].length;S++){S===1?I=T[c][D][0]:I=I+k+T[c][D][0];for(let W=1;W<T[c].length;W++)if(T[c][D][1]===T[c][W][2]){D=W;break}}T[c]=[T[c][0],I]}this.markedface=P,this.options.verbosity>1&&(console.log(`# Face names: ${O.map(c=>c[1]).join(" ")}`),console.log(`# Edge names: ${C.map(c=>c[1]).join(" ")}`),console.log(`# Vertex names: ${T.map(c=>c[1]).join(" ")}`));let N=[];for(let c of Q)N.push([c[0].makenormal(),c[1],"f"]);for(let c of C)N.push([c[0].makenormal(),c[1],"e"]);for(let c of T)N.push([c[0].makenormal(),c[1],"v"]);this.facenames=O,this.faceplanes=Q,this.edgenames=C,this.vertexnames=T,this.geonormals=N;let K=N.map(c=>c[1]);this.swizzler.setGripNames(K),this.options.verbosity>0&&console.log(`# Distances: face 1 edge ${this.edgedistance} vertex ${this.vertexdistance}`);for(let c=0;c<w.length;c++)for(let L of this.rotations){let E=w[c].rotateplane(L),D=!1;for(let I of this.moveplanes)if(E.sameplane(I)){D=!0;break}D||(this.moveplanes.push(E),F[c]&&this.moveplanes2.push(E))}let J=new Be(l),Y=this.moveplanes2.slice(),et=31;for(let c=0;c<Y.length;c++){let L=c+Math.floor((Y.length-c)*(et/65536));J=J.split(Y[L]),Y[L]=Y[c],et=(et*1657+101)%65536}let Z=J.collect([],!0);this.faces=Z,this.options.verbosity>0&&console.log(`# Faces is now ${Z.length}`),this.stickersperface=Z.length;let ot=[],q=vt(l);for(let c of this.rotations){let L=c.rotateface(l);q.dist(vt(L))<G&&ot.push(c)}let _=new Array(Z.length),H=[];for(let c=0;c<Z.length;c++){let L=Z[c].centermass();H.push([q.dist(L),L,c])}H.sort((c,L)=>c[0]-L[0]);for(let c=0;c<Z.length;c++){let L=H[c][2];if(!_[L]){_[L]=!0;for(let E of ot){let D=Z[L].rotate(E),I=D.centermass();for(let S=c+1;S<Z.length&&!(H[S][0]-H[c][0]>G);S++){let W=H[S][2];if(!_[W]&&I.dist(H[S][1])<G){_[W]=!0,Z[W]=D;break}}}}}this.shortedge=1e99;for(let c of Z)for(let L=0;L<c.length;L++){let E=(L+1)%c.length,D=c.get(L).dist(c.get(E));D<this.shortedge&&(this.shortedge=D)}this.options.verbosity>0&&console.log(`# Short edge is ${this.shortedge}`),t==="c"&&b&&!B&&!M&&(this.addNotationMapper="NxNxNCubeMapper",this.setReidOrder=!0),t==="c"&&M&&!b&&!B&&(this.addNotationMapper="SkewbMapper"),t==="t"&&(M||b)&&!B&&(this.addNotationMapper="PyraminxOrTetraminxMapper"),t==="o"&&b&&(this.notationMapper=new Dt(this.swizzler,new mt(["F","D","L","BL","R","U","BR","B"])),B||M||(this.addNotationMapper="FTOMapper")),t==="d"&&b&&(this.addNotationMapper="MegaminxMapper",this.notationMapper=new Dt(this.swizzler,new mt(["U","F","L","BL","BR","R","FR","FL","DL","B","DR","D"])))}keyface(e){return this.keyface2(e.centermass())}keyface2(e){let t="",s=String.fromCharCode;for(let i of this.moveplanesets)if(i.length>0){let n=e.dot(i[0]),o=0,r=1;for(;r*2<=i.length;)r*=2;for(;r>0;r>>=1)o+r<=i.length&&n>i[o+r-1].a&&(o+=r);if(o<47)t=t+s(33+o);else if(o<47+47*47)t=t+s(80+Math.floor(o/47)-1)+s(33+o%47);else if(o<47+47*47+47*47*47)t=t+s(80+Math.floor((o-47)/(47*47)-1))+s(80+Math.floor((o-47)/47)%47)+s(33+o%47);else throw Error("Too many slices for cubie encoding")}return t}keyface3(e){let t=e.centermass(),s=[];for(let i of this.moveplanesets)if(i.length>0){let n=t.dot(i[0]),o=0,r=1;for(;r*2<=i.length;)r*=2;for(;r>0;r>>=1)o+r<=i.length&&n>i[o+r-1].a&&(o+=r);s.push(o)}return s}findface(e){let t=this.keyface2(e),s=this.facelisthash.get(t);if(s.length===1)return s[0];for(let i=0;i+1<s.length;i++){let n=this.facelisthash.get(t)[i];if(Math.abs(e.dist(this.facecentermass[n]))<G)return n}return s[s.length-1]}project2d(e,t,s){let i=this.facenames[e][0],n=(t+1)%i.length,o=this.baseplanes[e],r=i[n].sub(i[t]),f=r.len();r=r.normalize();let h=r.cross(o).normalize(),m=s[1].sub(s[0]),p=m.len()/f;m=m.normalize();let d=m.b,y=m.c,u=r.smul(d).sub(h.smul(y)).smul(p),a=h.smul(d).sum(r.smul(y)).smul(p),l=new A(0,s[0].b-u.dot(i[t]),s[0].c-a.dot(i[t]),0);return[u,a,l]}allstickers(){let e="allstickers";this.faces=Me(this.baseplanerot,this.faces),this.options.verbosity>0&&console.log(`# Total stickers is now ${this.faces.length}`),this.facecentermass=new Array(this.faces.length);for(let g=0;g<this.faces.length;g++)this.facecentermass[g]=this.faces[g].centermass();let t=[],s=[];for(let g of this.moveplanes){let z=g.makenormal(),j=!1;for(let v of s)z.sameplane(v.makenormal())&&(j=!0);j||(s.push(z),t.push([]))}for(let g of this.moveplanes2){let z=g.makenormal();for(let j=0;j<s.length;j++)if(z.sameplane(s[j])){t[j].push(g);break}}for(let g=0;g<t.length;g++){let z=t[g].map(v=>v.normalizeplane()),j=s[g];for(let v=0;v<z.length;v++)z[v].makenormal().dist(j)>G&&(z[v]=z[v].smul(-1));z.sort((v,x)=>v.a-x.a),t[g]=z}this.moveplanesets=t,this.moveplanenormals=s;let i=t.map(g=>g.length);this.options.verbosity>0&&console.log(`# Move plane sets: ${i}`);let n=[];for(let g=0;g<t.length;g++)n.push([]);for(let g of this.rotations){if(Math.abs(Math.abs(g.a)-1)<G)continue;let z=g.makenormal();for(let j=0;j<t.length;j++)if(z.sameplane(s[j])){n[j].push(g);break}}this.moverotations=n;for(let g=0;g<n.length;g++){let z=n[g],j=z[0].makenormal();for(let v=0;v<z.length;v++)j.dist(z[v].makenormal())>G&&(z[v]=z[v].smul(-1));z.sort((v,x)=>v.angle()-x.angle()),n[g][0].dot(s[g])<0&&z.reverse()}let o=n.map(g=>1+g.length);this.movesetorders=o;let r=[],f="?";for(let g=0;g<t.length;g++){let z=s[g],j=null,v=null;for(let x of this.geonormals){let k=z.dot(x[0]);Math.abs(k-1)<G?(v=[x[1],x[2]],f=x[2]):Math.abs(k+1)<G&&(j=[x[1],x[2]],f=x[2])}if(v===null||j===null)throw new Error("Saw positive or negative sides as null");r.push([v[0],v[1],j[0],j[1],1+t[g].length]),this.addNotationMapper==="NxNxNCubeMapper"&&f==="f"&&(this.notationMapper=new te(1+t[g].length),this.addNotationMapper=""),this.addNotationMapper==="SkewbMapper"&&t[0].length===1&&(this.notationMapper=new ae(this.swizzler),this.addNotationMapper=""),this.addNotationMapper==="PyraminxOrTetraminxMapper"&&(t[0].length===2&&t[0][0].a===.333333333333333&&t[0][1].a===1.66666666666667?(this.notationMapper=new Nt(this.swizzler),this.addNotationMapper=""):(this.notationMapper=new ie(this.swizzler),this.addNotationMapper="")),this.addNotationMapper==="MegaminxMapper"&&f==="f"&&(1+t[g].length===3&&(this.notationMapper=new _t(this.notationMapper)),this.addNotationMapper=""),this.addNotationMapper==="FTOMapper"&&f==="f"&&(1+t[g].length===3&&(this.notationMapper=new qt(this.notationMapper,this.swizzler)),this.addNotationMapper="")}this.movesetgeos=r;let h=new Map,m=this.faces;for(let g=0;g<m.length;g++){let z=m[g],j=this.keyface(z);if(!h.get(j))h.set(j,[g]);else{let v=h.get(j);if(v.push(g),v.length===this.baseFaceCount){this.options.verbosity>0&&console.log("# Splitting core.");for(let x=0;x<v.length;x++){let k=`${j} ${x}`;h.set(k,[v[x]])}}}}this.facelisthash=h,this.options.verbosity>0&&console.log(`# Cubies: ${h.size}`);let p=[],d=[],y=[];for(let g of h.values())if(g.length!==this.baseFaceCount){if(g.length>1){let z=g.map(U=>m[U].centermass()),j=vt(z);for(let U=0;g.length>2;U++){let P=!1;for(let N=0;N<g.length;N++){let K=(N+1)%g.length;if(j.dot(z[N].cross(z[K]))<0){let J=z[N];z[N]=z[K],z[K]=J;let Y=g[N];g[N]=g[K],g[K]=Y,P=!0}}if(!P)break;if(U>1e3)throw new Error("Bad epsilon math; too close to border")}let v=0;for(let U of g)v|=1<<Math.floor(U/this.stickersperface);let x=this.markedface[v],k=-1;for(let U=0;U<g.length;U++)Math.floor(g[U]/this.stickersperface)===x&&(k=U);if(k<0)throw new Error("Could not find marked face in list");if(k!==0){let U=g.slice();for(let P=0;P<g.length;P++)g[P]=U[(k+P)%g.length]}}for(let z=0;z<g.length;z++){let j=g[z];d[j]=p.length,y[j]=z}p.push(g)}this.cubies=p,this.facetocubie=d,this.facetoord=y;let u=["?","CENTERS","EDGES","CORNERS","C4RNER","C5RNER"],a=[],l=[0,0,0,0,0,0],w=[],F=[],b=0,B=[],M=[],O=[],Q=[],T=g=>p[g].map(z=>this.getfaceindex(z)).join(" "),C=[];for(let g=0;g<p.length;g++){let z=p[g];if(z.length===0||F[g])continue;let j={},v=0;O.push(0),C.push([]);let x=z.length,k=l[x]++,U=u[x];(U===void 0||x===this.baseFaceCount)&&(U="CORE"),U=U+(k===0?"":k+1),a[b]=U,w[b]=x;let P=[g],N=0;for(F[g]=!0;N<P.length;){let K=P[N++],J=T(K);if((z.length>1||j[J]===void 0)&&(j[J]=v++),Q[K]=j[J],B[K]=b,C[b].push(K),M[K]=O[b]++,P.length<this.rotations.length){let Y=this.facecentermass[p[K][0]];for(let et of n){let Z=this.facetocubie[this.findface(Y.rotatepoint(et[0]))];F[Z]||(P.push(Z),F[Z]=!0)}}}b++}if(this.setReidOrder&&4<=this.stickersperface&&this.stickersperface<=9){let g=[["UF","UR","UB","UL","DF","DR","DB","DL","FR","FL","BR","BL"],["UFR","URB","UBL","ULF","DRF","DFL","DLB","DBR"],["U","L","F","R","B","D"]],z={};for(let j of g)for(let v=0;v<j.length;v++){let x=0;for(let k=0;k<j[v].length;k++)x|=1<<j[v].charCodeAt(k)-65;z[x]=v}for(let j of C)for(let v of j){let x=0;for(let k of p[v])x|=1<<this.facenames[this.getfaceindex(k)][1].charCodeAt(0)-65;M[v]=z[x]}}if(this.cubiesetnums=B,this.cubieordnums=M,this.cubiesetnames=a,this.cubieords=O,this.orbitoris=w,this.cubievaluemap=Q,this.cubiesetcubies=C,this.options.fixedPieceType!==null){for(let g=0;g<p.length;g++)if(this.options.fixedPieceType==="v"&&p[g].length>2||this.options.fixedPieceType==="e"&&p[g].length===2||this.options.fixedPieceType==="f"&&p[g].length===1){this.fixedCubie=g;break}if(this.fixedCubie<0)throw new Error(`Could not find a cubie of type ${this.options.fixedPieceType} to fix.`)}this.options.verbosity>0&&console.log(`# Cubie orbit sizes ${O}`)}unswizzle(e){let t=this.notationMapper.notationToInternal(e);return t===null?null:t.modified({family:this.swizzler.unswizzle(t.family)})}stringToBlockMove(e){let t=/^(([0-9]+)-)?([0-9]+)?([^0-9]+)([0-9]+'?)?$/,s=e.match(t);if(s===null)throw new Error(`Bad move passed ${e}`);let i=s[4],n,o;if(s[2]!==void 0){if(s[3]===void 0)throw new Error("Missing second number in range");n=parseInt(s[2],10)}s[3]!==void 0&&(o=parseInt(s[3],10));let r="1",f=1;return s[5]!==void 0&&(r=s[5],r[0]==="'"&&(r=`-${r.substring(1)}`),f=parseInt(r,10)),new R(new $(i,o,n),f)}parseMove(e){let t=this.notationMapper.notationToInternal(e);if(t===null)throw new Error(`Bad move ${e.family}`);e=t;let s=e.family,i=!1;if(s.endsWith("v")&&s[0]<="Z"){if(e.innerLayer!==void 0||e.outerLayer!==void 0)throw new Error("Cannot use a prefix with full cube rotations");s=s.slice(0,-1),i=!0}s.endsWith("w")&&s[0]<="Z"&&(s=s.slice(0,-1).toLowerCase());let n,o=-1,r=this.swizzler.unswizzle(s),f=!1;for(let p=0;p<this.movesetgeos.length;p++){let d=this.movesetgeos[p];r===d[0]&&(f=!0,n=d,o=p),r===d[2]&&(f=!1,n=d,o=p)}let h=1,m=1;if(s.toUpperCase()!==s&&(m=2),n===void 0)throw new Error(`Bad grip in move ${e.family}`);if(e.outerLayer!==void 0&&(h=e.outerLayer),e.innerLayer!==void 0&&(e.outerLayer===void 0?(m=e.innerLayer,s<="Z"?h=m:h=1):m=e.innerLayer),h--,m--,i&&(h=0,m=this.moveplanesets[o].length),h<0||h>this.moveplanesets[o].length||m<0||m>this.moveplanesets[o].length)throw new Error(`Bad slice spec ${h} ${m} vs ${this.moveplanesets[o].length}`);if(!Re&&h===0&&m===this.moveplanesets[o].length&&!i)throw new Error("! full puzzle rotations must be specified with v suffix.");return[void 0,o,h,m,f,e.amount]}parsemove(e){let t=this.parseMove(this.stringToBlockMove(e));return t[0]=e,t}genperms(){let e="genperms";if(this.cmovesbyslice.length>0)return;let t=[];if(this.options.orientCenters){for(let s=0;s<this.cubies.length;s++)if(this.cubies[s].length===1){let i=this.cubies[s][0],n=this.getfaceindex(i),o=this.basefaces[n].centermass();if(o.dist(this.facecentermass[i])<G){let r=1<<n|1<<this.baseFaceCount,f=this.markedface[r],h=this.baseplanes[f].makenormal(),m=-1,p=-1;for(let u=0;u<this.faces[i].length;u++){let a=this.faces[i].get(u),l=h.dot(a.sub(o));l>m&&(m=l,p=u)}let d=(p+1)%this.faces[i].length;if(Math.abs(h.dot(this.faces[i].get(d).sub(o))-m)<G&&(p=d),p!==0){let u=[];for(let a=0;a<this.faces[i].length;a++)u.push(this.faces[i].get((a+p)%this.faces[i].length));this.faces[i]=new Lt(u)}let y=this.basefaces[n].length;for(let u=1;u<y;u++)this.cubies[s].push(this.cubies[s][u-1]);this.duplicatedFaces[i]=y,this.duplicatedCubies[s]=y,this.orbitoris[this.cubiesetnums[s]]=y}}}for(let s=0;s<this.moveplanesets.length;s++){let i=this.moveplanesets[s],n=[],o=[i.length+1,0],r=1;for(;r*2<=i.length;)r*=2;for(let m=0;m<this.faces.length;m++){let p=0;if(i.length>0){let d=this.facecentermass[m].dot(i[0]);for(let y=r;y>0;y>>=1)p+y<=i.length&&d>i[p+y-1].a&&(p+=y);p=i.length-p}for(n.push(p);o.length<=p;)o.push(0);o[p]++}let f=new Array(o.length);for(let m=0;m<o.length;m++)f[m]=[];let h=[];for(let m=0;m<this.faces.length;m++){if(n[m]<0)continue;let p=[this.facetocubie[m],this.facetoord[m]],d=this.facecentermass[m],y=d,u=m,a=n[u];for(;;){n[u]=-1;let l=d.rotatepoint(this.moverotations[s][0]);if(l.dist(y)<G)break;u=this.findface(l),p.push(this.facetocubie[u],this.facetoord[u]),d=l}if(p.length>2&&this.options.orientCenters&&(this.cubies[p[0]].length===1||this.duplicatedCubies[p[0]]>1)&&this.facecentermass[m].dist(this.basefaces[this.getfaceindex(m)].centermass())<G){let l=this.faces[this.cubies[p[0]][0]];for(let w=0;w<p.length;w+=2){let F=this.faces[this.cubies[p[w]][0]],b=-1;for(let B=0;B<l.length;B++)if(F.get(B).dist(l.get(0))<G){b=B;break}if(b<0)throw new Error("Couldn't find rotation of center faces; ignoring for now.");p[w+1]=b,l=l.rotate(this.moverotations[s][0])}}if(p.length===2&&this.options.orientCenters){let l=this.facecentermass[m].dot(this.moveplanenormals[s]);for(let w=1;w<this.movesetorders[s];w++)l>0?p.push(p[0],w):p.push(p[0],(this.movesetorders[s]-w)%this.movesetorders[s])}if(p.length>2&&!h[p[0]]){if(p.length!==2*this.movesetorders[s])throw new Error("Bad length in perm gen");for(let l of p)f[a].push(l)}for(let l=0;l<p.length;l+=2)h[p[l]]=!0}for(let m=0;m<f.length;m++)f[m]=f[m].slice();t.push(f)}if(this.cmovesbyslice=t,this.options.moveList){let s=[];for(let i of this.options.moveList)s.push(this.parsemove(i));this.parsedmovelist=s}this.facelisthash.clear(),this.facecentermass=[]}getboundarygeometry(){return{baseplanes:this.baseplanes,facenames:this.facenames,faceplanes:this.faceplanes,vertexnames:this.vertexnames,edgenames:this.edgenames,geonormals:this.geonormals}}getmovesets(e){let t=this.moveplanesets[e].length,s=[];if(this.parsedmovelist!==void 0)for(let i of this.parsedmovelist)i[1]===e&&(i[4]?s.push([i[2],i[3]]):s.push([t-i[3],t-i[2]]),s.push(i[5]));else if(this.options.vertexMoves&&!this.options.allMoves){let i=this.movesetgeos[e];if(i[1]!==i[3])for(let n=0;n<t;n++)i[1]!=="v"?(this.options.outerBlockMoves?s.push([n+1,t]):s.push([n+1]),s.push(1)):(this.options.outerBlockMoves?s.push([0,n]):s.push([n,n]),s.push(1))}else for(let i=0;i<=t;i++)!this.options.allMoves&&i+i===t||(this.options.outerBlockMoves?i+i>t?s.push([i,t]):s.push([0,i]):s.push([i,i]),s.push(1));if(this.fixedCubie>=0){let i=this.keyface3(this.faces[this.cubies[this.fixedCubie][0]])[e],n=[];for(let o=0;o<s.length;o+=2){let r=s[o];if(i>=r[0]&&i<=r[1])if(r[0]===0)r=[r[1]+1,t];else if(t===r[1])r=[0,r[0]-1];else throw Error("fixed cubie option would disconnect move");let f=!1;for(let h=0;h<n.length;h+=2)if(n[h][0]===r[0]&&n[h][1]===r[1]&&n[h+1]===s[o+1]){f=!0;break}f||(n.push(r),n.push(s[o+1]))}s=n}return s}graybyori(e){let t=this.cubies[e].length;return this.duplicatedCubies[e]&&(t=1),t===1&&(this.options.grayCenters||!this.options.includeCenterOrbits)||t===2&&(this.options.grayEdges||!this.options.includeEdgeOrbits)||t>2&&(this.options.grayCorners||!this.options.includeCornerOrbits)}skipbyori(e){let t=this.cubies[e].length;return this.duplicatedCubies[e]&&(t=1),t===1&&!this.options.includeCenterOrbits||t===2&&!this.options.includeEdgeOrbits||t>2&&!this.options.includeCornerOrbits}skipcubie(e){return this.skipbyori(e)}header(e){return`${e+ze}
${e}
`}writegap(){let e=this.getOrbitsDef(!1),t=[],s=[];for(let n=0;n<e.moveops.length;n++){let o=`M_${ft(this.notationMapper,e.movenames[n])}`,r=!1;o[o.length-1]==="'"&&(o=o.substring(0,o.length-1),r=!0),s.push(o),r?t.push(`${o}:=${e.moveops[n].toPerm().inv().toGap()};`):t.push(`${o}:=${e.moveops[n].toPerm().toGap()};`)}t.push("Gen:=["),t.push(s.join(",")),t.push("];");let i=e.solved.identicalPieces();return t.push(`ip:=[${i.map(n=>`[${n.map(o=>o+1).join(",")}]`).join(",")}];`),t.push("# Size(Group(Gen));"),t.push("# Size(Stabilizer(Group(Gen), ip, OnTuplesSets));"),t.push(""),this.header("# ")+t.join(`
`)}writemathematica(){let e=this.getOrbitsDef(!1),t=[],s=[];t.push(`(* ${this.header("").trim()} *)`);for(let i=0;i<e.moveops.length;i++){let n=`m${ft(this.notationMapper,e.movenames[i])}`,o=!1;n[n.length-1]==="'"&&(n=n.substring(0,n.length-1),o=!0),s.push(n),o?t.push(`${n}=${e.moveops[i].toPerm().inv().toMathematica()};`):t.push(`${n}=${e.moveops[i].toPerm().toMathematica()};`)}return t.push(`gen={${s.join(",")}};`),t.join(`
`)}writeksolve(e="PuzzleGeometryPuzzle"){let t=this.getOrbitsDef(!1);return this.header("# ")+t.toKsolve(e,this.notationMapper).join(`
`)}getKPuzzleDefinition(e=!0,t=!0){let i=this.getOrbitsDef(e,t).toKPuzzleDefinition(t);if(i.experimentalPuzzleDescription=this.puzzleDescription,!i)throw new Error("Missing definition!");return i}getMoveFromBits(e,t,s,i,n,o){let r=[],f=[],h=[];for(let d of this.cubieords)f.push(tt(d)),h.push(it(d));for(let d=e[0];d<=e[1];d++){let y=i[d];for(let u=0;u<y.length;u+=2*o){let a=y.slice(u,u+2*o),l=this.cubiesetnums[a[0]];for(let b=0;b<a.length;b+=2)a[b]=this.cubieordnums[a[b]];let w=2,F=3;s&&(w=a.length-2,F=a.length-1),f[l]===tt(this.cubieords[l])&&(f[l]=f[l].slice(),this.orbitoris[l]>1&&!this.options.fixedOrientation&&(h[l]=h[l].slice()));for(let b=0;b<a.length;b+=2)f[l][a[(b+w)%a.length]]=a[b],this.orbitoris[l]>1&&!this.options.fixedOrientation&&(h[l][a[b]]=(a[(b+F)%a.length]-a[(b+1)%a.length]+2*this.orbitoris[l])%this.orbitoris[l])}}let m=new nt(tt(24),it(24),1);for(let d=0;d<this.cubiesetnames.length;d++)if(!(n&&!n[d]))if(this.orbitoris[d]===1||this.options.fixedOrientation)f[d]===tt(m.perm.length)?(f[d]!==m.perm&&(m=new nt(f[d],h[d],1)),r.push(m)):r.push(new nt(f[d],h[d],1));else{let y=new Array(h[d].length);for(let u=0;u<f[d].length;u++)y[u]=h[d][f[d][u]];r.push(new nt(f[d],y,this.orbitoris[d]))}let p=new Ht(r);return t!==1&&(p=p.mulScalar(t)),p}omitSet(e){for(let t of this.options.excludeOrbits)if(t===e)return!0;return!1}diffmvsets(e,t,s,i){for(let n=0;n<e.length;n+=2){let o=!1;for(let r=0;!o&&r<t.length;r+=2)i?e[n][0]+t[r][1]===s&&e[n][1]+t[r][0]===s&&e[n+1]===t[r+1]&&(o=!0):e[n][0]===t[r][0]&&e[n][1]===t[r][1]&&e[n+1]===t[r+1]&&(o=!0);if(!o)return!0}return!1}getOrbitsDef(e,t=!0){let s=[];if(e)for(let a=0;a<this.cubiesetnames.length;a++)s.push(1);let i=[],n=[],o=[],r=[];for(let a=0;a<this.moveplanesets.length;a++){let l=this.getmovesets(a);o.push(l),this.options.addRotations?r.push(1):r.push(0)}let f=[];for(let a=0;a<this.moveplanesets.length;a++){let l=this.moveplanesets[a].length,w=!1,F=o[a];for(let b=0;b<F.length;b+=2)F[b][0]===0&&F[b][1]===l&&(w=!0);f[a]=w}if(this.options.addRotations&&(this.options.moveList||this.options.fixedPieceType!==null)){for(let a=0;a<this.moverotations.length;a++)r[a]=0;for(let a=0;a<this.moveplanesets.length;a++){if(f[a]){r[a]=3;continue}for(let l=0;l<this.moverotations.length;l++){let w=this.moveplanenormals[a];for(let F=1;F*2<=this.movesetorders[l];F++){if(w=w.rotatepoint(this.moverotations[l][0]),r[l]&F)continue;let b=-1,B=!1;for(let O=0;O<this.moveplanenormals.length;O++)if(w.dist(this.moveplanenormals[O])<G){b=O;break}else if(w.dist(this.moveplanenormals[O].smul(-1))<G){b=O,B=!0;break}if(b<0)throw new Error("Could not find rotation");let M=o[b];(M.length!==o[a].length||this.moveplanesets[a].length!==this.moveplanesets[b].length||this.diffmvsets(M,o[a],this.moveplanesets[b].length,B))&&(r[l]|=F)}}}for(let a=0;a<this.moverotations.length;a++)if(r[a]===0)r[a]=1;else if(r[a]===1)this.movesetorders[a]>3?r[a]=2:r[a]=0;else if(r[a]===3)r[a]=0;else throw new Error("Impossible addrot val")}for(let a=0;a<this.moveplanesets.length;a++)r[a]!==0&&!f[a]&&(o[a].push([0,this.moveplanesets[a].length]),o[a].push(r[a]));for(let a=0;a<this.moveplanesets.length;a++){let l=o[a],w=this.movesetorders[a];for(let B=0;B<l.length;B+=2)for(let M=0;M<B;M+=2)if(l[B][0]===l[M][0]&&l[B][1]===l[M][1])throw new Error("Redundant moves in moveset.");let F=[];for(let B=0;B<l.length;B+=2)for(let M=l[B][0];M<=l[B][1];M++)F[M]=1;let b=this.cmovesbyslice[a];for(let B=0;B<b.length;B++){if(F[B]!==1)continue;let M=b[B];for(let O=0;O<M.length;O+=2*w){if(this.skipcubie(M[O]))continue;let Q=this.cubiesetnums[M[O]];s[Q]=1}}}for(let a=0;a<this.cubiesetnames.length;a++)if(s[a]){if(this.omitSet(this.cubiesetnames[a])){s[a]=0;continue}i.push(this.cubiesetnames[a]),n.push(new xt(this.cubieords[a],this.options.fixedOrientation?1:this.orbitoris[a]))}let h=[];for(let a=0;a<this.cubiesetnames.length;a++){if(!s[a]||this.omitSet(this.cubiesetnames[a]))continue;let l=[],w=[];for(let F=0;F<this.cubieords[a];F++){if(e)l.push(F);else{let b=this.cubiesetcubies[a][F];l.push(this.cubievaluemap[b])}w.push(0)}h.push(new nt(l,w,this.options.fixedOrientation?1:this.orbitoris[a]))}let m=[],p=[],d=[],y=[];if(t)for(let a=0;a<this.moveplanesets.length;a++){let w=this.moveplanesets[a].length,F=o[a],b=this.movesetgeos[a];for(let B=0;B<F.length;B+=2){let M=F[B],O,Q=!1;if(this.parsedmovelist!==void 0)for(let C of this.parsedmovelist){if(C[1]!==a)continue;let g=[];C[4]?g=[C[2],C[3]]:g=[w-C[3],w-C[2]],g[0]===M[0]&&g[1]===M[1]&&(O=C[0],Q=!C[4])}if(O)m.push(O),p.push(!0);else{let C=Ue(b,M,w);Q=C[1];let g=C[0];F[B+1]===1?m.push(g):m.push(g+F[B+1]),p.push(!1)}y.push(M[0]===0&&M[1]===w);let T=this.getMoveFromBits(M,F[B+1],Q,this.cmovesbyslice[a],s,this.movesetorders[a]);d.push(T)}}let u=new Gt(i,n,new Zt(h),m,d,y,p);return this.options.optimizeOrbits&&(u=u.optimize()),this.options.scrambleAmount!==0&&u.scramble(this.options.scrambleAmount),u}getScramble(e=0){let t=this.getOrbitsDef(!1);return t.toKTransformationData(t.getScrambleTransformation(e))}getMovesAsPerms(){return this.getOrbitsDef(!1).moveops.map(e=>e.toPerm())}showcanon(e){pe(this.getOrbitsDef(!1),e)}getsolved(){let e=[];for(let t=0;t<this.baseFaceCount;t++)for(let s=0;s<this.stickersperface;s++)e.push(t);return new rt(e)}getOrientationRotation(e){let[t,[s,i,n]]=e[0],o=new A(0,s,-i,n),[r,[f,h,m]]=e[1],p=new A(0,f,-h,m),d=null,y=null,u=this.swizzler.unswizzle(t),a=this.swizzler.unswizzle(r);for(let b of this.geonormals)u===b[1]&&(d=b[0]),a===b[1]&&(y=b[0]);if(!d)throw new Error(`Could not find feature ${t}`);if(!y)throw new Error(`Could not find feature ${r}`);let l=d.pointrotation(o);return y.rotatepoint(l).unproject(o).pointrotation(p.unproject(o)).mul(l)}getInitial3DRotation(){let e=this.baseFaceCount,t=null;if(this.options.puzzleOrientation?t=this.options.puzzleOrientation:this.options.puzzleOrientations&&(t=this.options.puzzleOrientations[e]),t||(t=je()[e]),!t)throw new Error("No default orientation?");return this.getOrientationRotation(t)}generate2dmapping(e=800,t=500,s=10,i=!1,n=.92){e-=2*s,t-=2*s;function o(v,x){let k=v[1][0]-v[0][0],U=v[1][1]-v[0][1],P=2*Math.PI/x,N=Math.cos(P),K=Math.sin(P);for(let J=2;J<x;J++){let Y=k*N+U*K;U=U*N-k*K,k=Y,v.push([v[J-1][0]+k,v[J-1][1]+U])}}this.genperms();let h=this.getboundarygeometry().facenames[0][0].length,m=this.net;if(m===null)throw new Error("No net?");let p={},d=0,y=0,u=1,a=0;p[m[0][0]]=[[1,0],[0,0]],o(p[m[0][0]],h);for(let v of m){let x=v[0];if(!p[x])throw new Error("Bad edge description; first edge not connected.");for(let k=1;k<v.length;k++){let U=v[k];U===""||p[U]||(p[U]=[p[x][k%h],p[x][(k+h-1)%h]],o(p[U],h))}}for(let v in p){let x=p[v];for(let k of x)d=Math.min(d,k[0]),u=Math.max(u,k[0]),y=Math.min(y,k[1]),a=Math.max(a,k[1])}let l=Math.min(e/(u-d),t/(a-y)),w=.5*(e-l*(u+d)),F=.5*(t-l*(a+y)),b={},B=this.getboundarygeometry(),M={},O=[[l+w,F],[w,F]];M[m[0][0]]=O,o(M[m[0][0]],h),b[this.facenames[0][1]]=this.project2d(0,0,[new A(0,O[0][0],O[0][1],0),new A(0,O[1][0],O[1][1],0)]);let Q=[];Q[0]=0;for(let v of m){let x=v[0];if(!M[x])throw new Error("Bad edge description; first edge not connected.");let k=-1;for(let P=0;P<B.facenames.length;P++)if(x===B.facenames[P][1]){k=P;break}if(k<0)throw new Error(`Could not find first face name ${x}`);let U=B.facenames[k][0];for(let P=1;P<v.length;P++){let N=v[P];if(N===""||M[N])continue;M[N]=[M[x][P%h],M[x][(P+h-1)%h]],o(M[N],h);let K=Q[k],J=U[(K+P)%h].sum(U[(K+P+h-1)%h]).smul(.5),Y=at(B.edgenames,J),et=B.edgenames[Y][1],Z=Pe(et,this.facenames),ot=Z[x===Z[0]?1:0],q=-1;for(let H=0;H<B.facenames.length;H++)if(ot===B.facenames[H][1]){q=H;break}if(q<0)throw new Error("Could not find second face name");let _=B.facenames[q][0];for(let H=0;H<_.length;H++)if(_[H].sum(_[(H+1)%h]).smul(.5).dist(J)<=G){let L=M[x][(P+h-1)%h],E=M[x][P%h];Q[q]=H,b[ot]=this.project2d(q,H,[new A(0,E[0],E[1],0),new A(0,L[0],L[1],0)]);break}}}let T=0,C=0,g=this.getInitial3DRotation();for(let v of this.faces){i&&(v=v.rotate(g));for(let x=0;x<v.length;x++)T=Math.max(T,Math.abs(v.get(x).b)),C=Math.max(C,Math.abs(v.get(x).c))}let z=Math.min(t/C/2,(e-s)/T/4);return(v,x)=>{if(i){x=x.rotatepoint(g);let k=.5*s+.25*e,U=this.baseplanes[v].rotateplane(g).d<0?1:-1;return[s+e*.5+U*(k-x.b*z),s+t*.5+x.c*z]}else{let k=b[this.facenames[v][1]];return[s+n*x.dot(k[0])+k[2].b,s+t-n*x.dot(k[1])-k[2].c]}}}generatesvg(e=800,t=500,s=10,i=!1){let n=this.generate2dmapping(e,t,s,i);function o(d,y,u){return`<polygon id="${d}" class="sticker" style="fill: ${u}" points="${y.map(a=>`${a[0]} ${a[1]}`).join(" ")}"/>
`}let r=this.getsolved(),f=[],h=[];for(let d=0;d<this.baseFaceCount;d++)f[d]=this.colors[this.facenames[d][1]];for(let d=0;d<this.faces.length;d++){let y=this.faces[d],u=Math.floor(d/this.stickersperface),a=[];for(let l=0;l<y.length;l++)a.push(n(u,y.get(l)));h.push(a)}let m=[];for(let d=0;d<this.baseFaceCount;d++){m.push("<g>"),m.push(`<title>${this.facenames[d][1]}</title>
`);for(let y=0;y<this.stickersperface;y++){let u=d*this.stickersperface+y,a=this.facetocubie[u],l=this.facetoord[u],w=this.cubiesetnums[a],F=this.cubieordnums[a],b=this.graybyori(a)?"#808080":f[r.p[u]],B=`${this.cubiesetnames[w]}-l${F}-o${l}`;if(m.push(o(B,h[u],b)),this.duplicatedFaces[u])for(let M=1;M<this.duplicatedFaces[u];M++)B=`${this.cubiesetnames[w]}-l${F}-o${M}`,m.push(o(B,h[u],b))}m.push("</g>")}return`<svg id="svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 800 500">
<style type="text/css"><![CDATA[.sticker { stroke: #000000; stroke-width: 1px; }]]></style>
${m.join("")}</svg>`}get3d(e){let t=[],s=this.getInitial3DRotation(),i=[],n=.52*this.basefaces[0].get(0).len();for(let h=0;h<this.basefaces.length;h++){let m=this.basefaces[h].rotate(s),p=this.facenames[h][1];i.push({coords:yt(m,n),name:p})}for(let h=0;h<this.faces.length;h++){let m=Math.floor(h/this.stickersperface),p=this.facetocubie[h],d=this.facetoord[h],y=this.cubiesetnums[p],u=this.cubieordnums[p],a=this.graybyori(p)?e?.darkIgnoredOrbits?"#222222":"#808080":this.colors[this.facenames[m][1]];e?.stickerColors&&(a=e.stickerColors[h]);let l=this.faces[h].rotate(s);t.push({coords:yt(l,n),color:a,orbit:this.cubiesetnames[y],ord:u,ori:d,face:m});let w=l;if(this.duplicatedFaces[h]){let F=w.length/this.duplicatedFaces[h];for(let b=1;b<this.duplicatedFaces[h];b++){for(let B=0;B<F;B++)w=w.rotateforward();t.push({coords:yt(w,n),color:a,orbit:this.cubiesetnames[y],ord:u,ori:b,face:m,isDup:!0})}}}let o=[];for(let h=0;h<this.movesetgeos.length;h++){let m=this.movesetgeos[h],p=this.movesetorders[h];for(let d of this.geonormals)m[0]===d[1]&&m[1]===d[2]&&(o.push({coordinates:ct(d[0].rotatepoint(s),1),quantumMove:new R(m[0]),order:p}),o.push({coordinates:ct(d[0].rotatepoint(s).smul(-1),1),quantumMove:new R(m[2]),order:p}))}let r=this.generate2dmapping(2880,2160,0,!1,1),f=(()=>{let h=s.invrot();return(m,p)=>{let d=new A(0,p[0]*n,-p[1]*n,p[2]*n);d=d.rotatepoint(h);let y=r(m,d);return y[0]/=2880,y[1]=1-y[1]/2160,y}})().bind(this);return{stickers:t,faces:i,axis:o,unswizzle:this.unswizzle.bind(this),notationMapper:this.notationMapper,textureMapper:{getuv:f}}}getGeoNormal(e){let t=this.getInitial3DRotation(),s=this.swizzler.unswizzle(e);for(let i of this.geonormals)if(s===i[1]){let n=ct(i[0].rotatepoint(t),1);return Math.abs(n[0])<G&&Math.abs(n[2])<G&&(n[0]=0,n[2]=1e-6),n}}getfaceindex(e){let t=this.stickersperface;return Math.floor(e/t)}textForTwizzleExplorer(){return`Faces ${this.baseplanerot.length}
Stickers per face ${this.stickersperface}
Short edge ${this.shortedge}
Cubies ${this.cubies.length}
Edge distance ${this.edgedistance}
Vertex distance ${this.vertexdistance}`}writeSchreierSims(e){let s=this.getOrbitsDef(!1).reassemblySize();e(`Reassembly size is ${s}`);let i=Fe(this.getMovesAsPerms(),e),n=s/i;e(`Ratio is ${n}`)}},Ke=class{constructor(e,t){this.pg=e,this.orbitNames=t.orbitnames}orbitNames;lookupMove(e){let t=this.pg.parseMove(e);if(this.pg.parsedmovelist){let o=!1;for(let r of this.pg.parsedmovelist)r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&(o=!0);if(!o)return null}let s=[t[2],t[3]];if(!t[4]){let o=this.pg.moveplanesets[t[1]].length;s=[o-t[3],o-t[2]]}let i=this.pg.getMoveFromBits(s,t[5],!t[4],this.pg.cmovesbyslice[t[1]],void 0,this.pg.movesetorders[t[1]]);return Gt.transformToKTransformationData(this.orbitNames,i)}remapKPuzzleDefinition(e){return le(e,this.pg.notationMapper)}};export{Ne as EXPERIMENTAL_PUZZLE_BASE_SHAPES,Ae as EXPERIMENTAL_PUZZLE_CUT_TYPES,Ke as ExperimentalPGNotation,Oe as PuzzleGeometry,A as Quat,Se as getPG3DNamedPuzzles,Te as getPuzzleDescriptionString,Ce as getPuzzleGeometryByDesc,Ge as getPuzzleGeometryByName,Ie as parseOptions,Jt as parsePuzzleDescription,Fe as schreierSims};
